(function(e,t){e(document).ready(function(){function o(t,o){void 0===t.val&&(t=e(t));var n=t.val();t.val(o);var a=function(){t.val(n),e(window).off("beforeunload",a)};e(window).on("beforeunload",a),e("#pivot").submit()}function n(t,o){e(t.get(o)).remove(),e("#pivot").submit()}function a(n,a,i,r,s,l){e("#subset-selector").modal("show"),e("#subset-selector h4 span").text(a.label),i.find("div").remove(),r.find("div").remove();var c=0,d={},u=function(t,o){e.each(t,function(t,n){var a=e("<div></div>").text(n.label).attr("data-val",n.sid).attr("data-sort",++c).addClass("l"+o);o>0&&a.addClass("l"),i.append(a),d[n.sid]=a,u(n.children,o+1)})};u(a.children,0),e.each(s,function(e){r.append(d[s[e]].clone())}),r.closest(".form-group").siblings(".btn").click(function(){r.find("div").remove()}),i.closest(".form-group").siblings(".btn").click(function(){r.find("div").remove(),i.find("div:not(.disabled)").clone().click(function(){e(this).remove()}).appendTo(r)}),r.find("div").click(function(){e(this).remove()}),i.find("div").click(function(){var t=e(this).clone();if(!(r.find("div[data-val="+t.attr("data-val")+"]").length>0)){var o=parseInt(t.attr("data-sort"),10),n=!1;t.click(function(){e(this).remove()}),r.find("div").each(function(){return!(parseInt(e(this).attr("data-sort"),10)>o)||(e(this).before(t),n=!0,!1)}).removeClass("just-added"),n||r.append(t),t.addClass("just-added"),r.length&&r.scrollTop(r.scrollTop()-r.offset().top+t.offset().top-r.height()/2)}}),e("#subset-selector .save").click(function(){var n=[];r.find("div").each(function(){n.push(e(this).attr("data-val"))}),o(l,a.id+t.separator+n.join(t.subsetSeparator)+t.subsetSeparator)})}function i(e){e.addEventListener("show.bs.dropdown",r),e.addEventListener("hide.bs.dropdown",s)}function r(){e(this).closest("th").addClass("bs-toggle-z-index")}function s(){e(this).closest("th").removeClass("bs-toggle-z-index")}var l=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)||!(null==window.mozInnerScreenX)||navigator.vendor.indexOf("Apple")>-1;l?(e("table.cube").wrap('<div class="sticky-table sticky-ltr-cells"></div>'),e(document).trigger("stickyTable")):e(".sticky-table").length&&(e("table.cube th.sticky-cell").removeAttr("style"),e("table.cube tr.sticky-header th").removeAttr("style"),e("table.cube tr.sticky-header").removeAttr("style"),e("table.cube").unwrap());var c=e(this);e(".fa-expand-alt-cube").click(function(){c.toggleClass("fa-expand-alt fa-compress-alt"),e("body").toggleClass("full-screen")});var d=e(".tree-browser");e(".browser-toggle").click(function(){d.find("li, .tree").removeClass("open closed"),d.find(".caret").addClass("caret-right"),d.toggleClass("active")});var u=function(t,o,n){for(var a=e("<ul>").addClass("tree"),i=0;i<o.children.length;++i){var r=e("<li>").append(e("<span>").attr("dim-ref",t).attr("node-ref",o.children[i].sid).append(o.children[i].label));o.children[i].children.length>0&&(r.find("span").prepend(e("<span>").addClass("caret caret-right")),r.append(u(t,o.children[i]))),a.append(r)}return a},p=function(e){return e.index()+1},f=function(e){return e.parent().index()+1};e(".label").hover(function(){e(this).removeClass("hover")},function(){e(this).addClass("hover")}),e.each(t.pivot.dim,function(t,o){var n=e("<span>").html(o.label).attr("dim-ref",o.id).attr("node-ref","0"),a=e("<li>").append(n);o.children.length>0&&(n.prepend(e("<span>").addClass("caret caret-right")),a.append(u(o.id,o))),d.append(a)});var v=e(".tree-browser>li>span,.tree>li>span").click(function(){var o=e(this),n=o.find("span").toggleClass("caret-right");if(n.length>0&&(o.siblings("ul").toggleClass("open"),o.closest("li").siblings().toggleClass("closed")),window.sessionStorage){var a=t.id+":"+o.attr("dim-ref")+"-"+o.attr("node-ref");window.sessionStorage.getItem(a)?window.sessionStorage.removeItem(a):window.sessionStorage.setItem(a,"1")}});window.sessionStorage&&v.each(function(){var o=e(this),n=t.id+":"+o.attr("dim-ref")+"-"+o.attr("node-ref");if(window.sessionStorage.getItem(n)){var a=o.find("span").toggleClass("caret-right");a.length>0&&(o.siblings("ul").toggleClass("open"),o.closest("li").siblings().toggleClass("closed"))}}),e(".tree>li>span").draggable({cursor:"move",helper:"clone",appendTo:"body",start:function(o,n){e(n.helper).css("top","-20px").css("z-index","1000"),e(".pivot-content").toggleClass("drop-active",!0),d.removeClass("active");var a=n.helper.attr("dim-ref");t.pivot.multipleMeasuresShown||"measure"!==a?m.find("span").text(t.messages["cube.filter"]):m.find("span").text(t.messages["cube.filter.measure"])},stop:function(){e(".pivot-content").toggleClass("drop-active",!1)}}),e(".measure-target").droppable({accept:function(e){return"measure"===e.attr("dim-ref")},drop:function(n,a){0===e("#filter-measure").length&&e("#pivot").append('<input type="text" name="filter" id="measure" dim-ref="measure" class="form-control" readonly>'),o(e("#filter-measure"),a.draggable.attr("dim-ref")+t.separator+a.draggable.attr("node-ref"))}});var m=e(".filter-target").droppable({hoverClass:"drop-hover",drop:function(n,a){var i=a.draggable.attr("dim-ref"),r=e(".filter-"+i);0===r.length&&(r=e('<input type="text" name="filter" class="form-control" id="filter-'+i+'" dim-ref="'+i+'" readonly>'),e("#pivot").append(r)),o(r,a.draggable.attr("dim-ref")+t.separator+a.draggable.attr("node-ref"))}});e(".row-target").droppable({drop:function(n,a){e(".row-selection").length<p(e(this))&&e("#pivot").append('<input type="text" name="row" class="row-selection form-control" readonly>'),o(e(".row-selection").get(p(e(this))-1),a.draggable.attr("dim-ref")+t.separator+a.draggable.attr("node-ref"))},over:function(t,o){e("table th.row-target[data-level="+e(this).attr("data-level")+"]").addClass("drop-hover"),e(this).addClass("hover")},out:function(){e("table th.row-target[data-level="+e(this).attr("data-level")+"]").removeClass("drop-hover"),e(this).removeClass("hover")}}),e(".column-target").droppable({drop:function(n,a){e(".column-selection").length<f(e(this))&&e("#pivot").append('<input type="text" name="column" class="column-selection form-control" readonly>'),o(e(".column-selection").get(f(e(this))-1),a.draggable.attr("dim-ref")+t.separator+a.draggable.attr("node-ref"))},over:function(){e(this).closest("tr").find("th").toggleClass("drop-hover",!0)},out:function(){e(this).closest("tr").find("th").toggleClass("drop-hover",!1)}}),e(".column.dropdown-menu .remove").click(function(t){t.preventDefault(),n(e(".column-selection"),e(this).attr("data-ref"))}),e(".row.dropdown-menu .remove").click(function(t){t.preventDefault(),n(e(".row-selection"),e(this).attr("data-ref"))}),e("#subset-selector .selectable, #subset-selector .selected").each(function(){var t=e(this),o=t.find("input"),n="";o.keyup(function(){var o=new RegExp(this.value,"i"),a=t.find(".options").children();this.value.length<n.length&&(a.show(),a.toggleClass("disabled",!1)),n=this.value,a.filter(function(){return!o.test(e(this).text())}).toggleClass("disabled",!0).hide()})}),e(".column.dropdown-menu .select-subset").click(function(o){var n=e(this).closest(".dropdown").attr("data-level"),i=0,r=e("#subset-selector .selectable .options"),s=e("#subset-selector .selected .options"),l=t.columns[n].nodes,c=e(".column-selection").get(n);e.each(t.pivot.dim,function(e,o){o.id===t.columns[n].dimension&&(i=o)}),a(n,i,r,s,l,c)}),e(".row.dropdown-menu .select-subset").click(function(o){var n=e(this).closest(".dropdown").attr("data-level"),i=0,r=e("#subset-selector .selectable .options"),s=e("#subset-selector .selected .options"),l=t.rows[n].nodes,c=e(".row-selection").get(n);e.each(t.pivot.dim,function(e,o){o.id===t.rows[n].dimension&&(i=o)}),a(n,i,r,s,l,c)}),e(".column.dropdown-menu .drill-up").click(function(t){t.preventDefault(),o(e(".column-selection").get(e(this).attr("data-ref")),e(this).attr("value-ref"))});var g=function(t,o,n){var a=t.attr("data-ref"),i=e(o),r=i.get(a).value;i.get(+a).value=i.get(+a+n).value,i.get(+a+n).value=r,e("#pivot").submit()};e(".column.dropdown-menu .move-up").click(function(t){t.preventDefault(),g(e(this),".column-selection",-1)}),e(".column.dropdown-menu .move-down").click(function(t){t.preventDefault(),g(e(this),".column-selection",1)}),e(".row.dropdown-menu .move-up").click(function(t){t.preventDefault(),g(e(this),".row-selection",-1)}),e(".row.dropdown-menu .move-down").click(function(t){t.preventDefault(),g(e(this),".row-selection",1)}),e(".column.dropdown-menu .expand").click(function(t){t.preventDefault();var n=e(this),a=n.data("ref"),i=n.data("index");o(e(".column-selection").get(i),a+"L")}),e(".row.dropdown-menu .expand").click(function(t){t.preventDefault();var n=e(this),a=n.data("ref"),i=n.data("index");o(e(".row-selection").get(i),a+"L")}),e(".column.dropdown-menu .add-level").click(function(t){var o=e('<input type="text" name="column" class="column-selection form-control" readonly>');e("#pivot").append(o),o.val(e(this).data("ref")+"L"),e("#pivot").submit()}),e(".row.dropdown-menu .add-level").click(function(t){var o=e('<input type="text" name="row" class="row-selection form-control" readonly>');e("#pivot").append(o),o.val(e(this).data("ref")+"L"),e("#pivot").submit()}),e(".row.dropdown-menu .drill-up").click(function(t){t.preventDefault(),o(e(".row-selection").get(e(this).attr("data-ref")),e(this).attr("value-ref"))}),e(".row-target a").click(function(t){t.preventDefault(),o(e(".row-selection").get(e(this).closest(".row-target").attr("data-level")),e(this).attr("data-ref"))}),e(".column-target a").click(function(t){t.preventDefault(),o(e(".column-selection").get(e(this).closest(".column-target").attr("data-level")),e(this).attr("data-ref"))}),e(".reset-action").click(function(){e("#pivot input").remove(),e("#pivot").submit()}),e(".transpose-action").click(function(){e(".column-selection").attr("name","row"),e(".row-selection").attr("name","column"),e("#pivot").submit()}),e(".hide-empty-action").click(function(){var o=e("#pivot input[name=fo]");t.toggleField(o),e("#pivot").submit()}),e(".hide-zero-action").click(function(){var o=e("#pivot input[name=fz]");t.toggleField(o),e("#pivot").submit()}),e(".show-codes-action").click(function(){var o=e("#pivot input[name=sc]");t.toggleField(o),e("#pivot").submit()}),e("dl dd > span").click(function(){e(e(".filter-"+e(this).attr("data-ref")).get(e(this).attr("data-index"))).remove(),e("#pivot").submit()}).hover(function(){e(this).toggleClass("hover")});var h=e('<div class="dropdown">'),w=e('<button type="button" class="btn btn-secondary btn-sm drowdown-toggle bs-dd-toggle" data-bs-toggle="dropdown"><span class="caret"></span></button>'),b=e('<ul class="dropdown-menu">'),k=e('<li><a role="menuitem" class="asc dropdown-item">'+t.messages["cube.dimension.sort.asc"]+"</a></li>"),C=e('<li><a role="menuitem" class="desc dropdown-item">'+t.messages["cube.dimension.sort.desc"]+"</a></li>"),y=e('<li><a role="menuitem" class="rowhide dropdown-item">'+t.messages["cube.dimension.hide"]+"</a></li>"),x=e('<li><a role="menuitem" class="info dropdown-item">'+t.messages["cube.dimension.info"]+"</a></li>");b.append(k).append(C).append(y).append(x),h.append(w).append(b),e(".row-target, .column-target").not(".accept-all").append(h).find(".asc,.desc").click(function(){var o=e("#pivot input[name=sort]"),n=e("#pivot input[name=mode]");t.toggleField(o),t.toggleField(n);var a=e(this).hasClass("asc")?"asc":"desc";n.val(a),e(this).closest(".row-target").length>0?o.val("r"+e(this).closest("th").attr("data-ref")):o.val("c"+e(this).closest("th").attr("data-ref")),e("#pivot").submit()});var D=function(e){var t=window.open(e,"tikumetadata","scrollbars=1,menubar=0,resizable=1,status=0,location=0,width=650,height=450,screenX=250,screenY=350");window.focus&&t.focus()};e("th .info").click(function(o){o.preventDefault();var n=e(this).closest(".row-target, .column-target"),a=n.find("a").first().attr("data-ref"),i=a.lastIndexOf("-");D(window.location.protocol+"//"+window.location.host+t.url+a.substring(i+1))}),e("#measure-meta").click(function(e){e.preventDefault(),D(this.href)}),e("th .rowhide").click(function(){var n=e(this).closest(".row-target, .column-target"),a=n.attr("data-level"),i=n.find("a").first().attr("data-ref"),r=0,s=0,l=0;n.is(".row-target")?(r=t.rows[a].dimension,s=t.rows[a].nodes,l=e(".row-selection").get(a)):(r=t.columns[a].dimension,s=t.columns[a].nodes,l=e(".column-selection").get(a)),s.splice(s.indexOf(i.substring(i.indexOf(t.separator)+1)),1),o(l,r+t.separator+s.join(t.subsetSeparator)+t.subsetSeparator)}),document.cookie.match(/cube_info/)||(e(".quick-info").removeClass("d-none"),e("#close-quick-info").click(function(){var t=new Date,o=t.getTime()+864e9;t.setTime(o),document.cookie="cube_info=shown;expires="+t.toGMTString()+"; path=/",e(".quick-info").removeClass("show")})),document.querySelectorAll(".bs-dd-toggle").forEach(i)})})(window.jQuery,window.thl);
!function(w,b){w(document).ready(function(){var t=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)||!(null==window.mozInnerScreenX)||-1<navigator.vendor.indexOf("Apple");function c(e,t){void 0===e.val&&(e=w(e));var o=e.val();e.val(t);var n=function(){e.val(o),w(window).off("beforeunload",n)};w(window).on("beforeunload",n),w("#pivot").submit()}function o(e,t){w(e.get(t)).remove(),w("#pivot").submit()}w(".fa-expand-alt-cube").click(function(){var e=w(this);e.hasClass("fa-expand-alt")&&t?(w("table.cube").wrap('<div class="sticky-table sticky-ltr-cells"></div>'),w(document).trigger("stickyTable")):w(".sticky-table").length&&(w("table.cube th.sticky-cell").removeAttr("style"),w("table.cube tr.sticky-header th").removeAttr("style"),w("table.cube tr.sticky-header").removeAttr("style"),w("table.cube").unwrap()),e.toggleClass("fa-expand-alt fa-compress-alt"),w("body").toggleClass("full-screen")});var a=w(".tree-browser");w(".browser-toggle").click(function(){a.find("li, .tree").removeClass("open closed"),a.find(".caret").addClass("caret-right"),a.toggleClass("active")});function n(e){return e.index()+1}function i(e){return e.parent().index()+1}var r=function(e,t,o){for(var n=w("<ul>").addClass("tree"),a=0;a<t.children.length;++a){var i=w("<li>").append(w("<span>").attr("dim-ref",e).attr("node-ref",t.children[a].sid).append(t.children[a].label));0<t.children[a].children.length&&(i.find("span").prepend(w("<span>").addClass("caret caret-right")),i.append(r(e,t.children[a]))),n.append(i)}return n};w(".label").hover(function(){w(this).removeClass("hover")},function(){w(this).addClass("hover")}),w.each(b.pivot.dim,function(e,t){var o=w("<span>").html(t.label).attr("dim-ref",t.id).attr("node-ref","0"),n=w("<li>").append(o);0<t.children.length&&(o.prepend(w("<span>").addClass("caret caret-right")),n.append(r(t.id,t))),a.append(n)});var e=w(".tree-browser>li>span,.tree>li>span").click(function(){var e=w(this);0<e.find("span").toggleClass("caret-right").length&&(e.siblings("ul").toggleClass("open"),e.closest("li").siblings().toggleClass("closed")),window.sessionStorage&&(e=b.id+":"+e.attr("dim-ref")+"-"+e.attr("node-ref"),window.sessionStorage.getItem(e)?window.sessionStorage.removeItem(e):window.sessionStorage.setItem(e,"1"))});window.sessionStorage&&e.each(function(){var e=w(this),t=b.id+":"+e.attr("dim-ref")+"-"+e.attr("node-ref");window.sessionStorage.getItem(t)&&0<e.find("span").toggleClass("caret-right").length&&(e.siblings("ul").toggleClass("open"),e.closest("li").siblings().toggleClass("closed"))}),w(".tree>li>span").draggable({cursor:"move",helper:"clone",appendTo:"body",start:function(e,t){w(t.helper).css("top","-20px").css("z-index","1000"),w(".pivot-content").toggleClass("drop-active",!0),a.removeClass("active");t=t.helper.attr("dim-ref");b.pivot.multipleMeasuresShown||"measure"!==t?s.find("span").text(b.messages["cube.filter"]):s.find("span").text(b.messages["cube.filter.measure"])},stop:function(){w(".pivot-content").toggleClass("drop-active",!1)}}),w(".measure-target").droppable({accept:function(e){return"measure"===e.attr("dim-ref")},drop:function(e,t){0===w("#filter-measure").length&&w("#pivot").append('<input type="text" name="filter" id="measure" dim-ref="measure" class="form-control" readonly>'),c(w("#filter-measure"),t.draggable.attr("dim-ref")+b.separator+t.draggable.attr("node-ref"))}});var s=w(".filter-target").droppable({hoverClass:"drop-hover",drop:function(e,t){var o=t.draggable.attr("dim-ref"),n=w(".filter-"+o);0===n.length&&(n=w('<input type="text" name="filter" class="form-control" id="filter-'+o+'" dim-ref="'+o+'" readonly>'),w("#pivot").append(n)),c(n,t.draggable.attr("dim-ref")+b.separator+t.draggable.attr("node-ref"))}});function l(e,t,a,n,o,i){w("#subset-selector").modal("show"),w("#subset-selector h4 span").text(t.label),a.find("div").remove(),n.find("div").remove();var r=0,s={},l=function(e,n){w.each(e,function(e,t){var o=w("<div></div>").text(t.label).attr("data-val",t.sid).attr("data-sort",++r).addClass("l"+n);0<n&&o.addClass("l"),a.append(o),s[t.sid]=o,l(t.children,n+1)})};l(t.children,0),w.each(o,function(e){n.append(s[o[e]].clone())}),n.closest(".form-group").siblings(".btn").click(function(){n.find("div").remove()}),a.closest(".form-group").siblings(".btn").click(function(){n.find("div").remove(),a.find("div:not(.disabled)").clone().click(function(){w(this).remove()}).appendTo(n)}),n.find("div").click(function(){w(this).remove()}),a.find("div").click(function(){var e,t,o=w(this).clone();0<n.find("div[data-val="+o.attr("data-val")+"]").length||(e=parseInt(o.attr("data-sort"),10),t=!1,o.click(function(){w(this).remove()}),n.find("div").each(function(){return!(parseInt(w(this).attr("data-sort"),10)>e)||(w(this).before(o),!(t=!0))}).removeClass("just-added"),t||n.append(o),o.addClass("just-added"),n.length&&n.scrollTop(n.scrollTop()-n.offset().top+o.offset().top-n.height()/2))}),w("#subset-selector .save").click(function(){var e=[];n.find("div").each(function(){e.push(w(this).attr("data-val"))}),c(i,t.id+b.separator+e.join(b.subsetSeparator)+b.subsetSeparator)})}w(".row-target").droppable({drop:function(e,t){w(".row-selection").length<n(w(this))&&w("#pivot").append('<input type="text" name="row" class="row-selection form-control" readonly>'),c(w(".row-selection").get(n(w(this))-1),t.draggable.attr("dim-ref")+b.separator+t.draggable.attr("node-ref"))},over:function(e,t){w("table th.row-target[data-level="+w(this).attr("data-level")+"]").addClass("drop-hover"),w(this).addClass("hover")},out:function(){w("table th.row-target[data-level="+w(this).attr("data-level")+"]").removeClass("drop-hover"),w(this).removeClass("hover")}}),w(".column-target").droppable({drop:function(e,t){w(".column-selection").length<i(w(this))&&w("#pivot").append('<input type="text" name="column" class="column-selection form-control" readonly>'),c(w(".column-selection").get(i(w(this))-1),t.draggable.attr("dim-ref")+b.separator+t.draggable.attr("node-ref"))},over:function(){w(this).closest("tr").find("th").toggleClass("drop-hover",!0)},out:function(){w(this).closest("tr").find("th").toggleClass("drop-hover",!1)}}),w(".column.dropdown-menu .remove").click(function(e){e.preventDefault(),o(w(".column-selection"),w(this).attr("data-ref"))}),w(".row.dropdown-menu .remove").click(function(e){e.preventDefault(),o(w(".row-selection"),w(this).attr("data-ref"))}),w("#subset-selector .selectable, #subset-selector .selected").each(function(){var o=w(this),e=o.find("input"),n="";e.keyup(function(){var e=new RegExp(this.value,"i"),t=o.find(".options").children();this.value.length<n.length&&(t.show(),t.toggleClass("disabled",!1)),n=this.value,t.filter(function(){return!e.test(w(this).text())}).toggleClass("disabled",!0).hide()})}),w(".column.dropdown-menu .select-subset").click(function(e){var o=w(this).closest(".dropdown").attr("data-level"),n=0,t=w("#subset-selector .selectable .options"),a=w("#subset-selector .selected .options"),i=b.columns[o].nodes,r=w(".column-selection").get(o);w.each(b.pivot.dim,function(e,t){t.id===b.columns[o].dimension&&(n=t)}),l(0,n,t,a,i,r)}),w(".row.dropdown-menu .select-subset").click(function(e){var o=w(this).closest(".dropdown").attr("data-level"),n=0,t=w("#subset-selector .selectable .options"),a=w("#subset-selector .selected .options"),i=b.rows[o].nodes,r=w(".row-selection").get(o);w.each(b.pivot.dim,function(e,t){t.id===b.rows[o].dimension&&(n=t)}),l(0,n,t,a,i,r)}),w(".column.dropdown-menu .drill-up").click(function(e){e.preventDefault(),c(w(".column-selection").get(w(this).attr("data-ref")),w(this).attr("value-ref"))});function d(e,t,o){var n=e.attr("data-ref"),t=(e=w(t)).get(n).value;e.get(+n).value=e.get(+n+o).value,e.get(+n+o).value=t,w("#pivot").submit()}w(".column.dropdown-menu .move-up").click(function(e){e.preventDefault(),d(w(this),".column-selection",-1)}),w(".column.dropdown-menu .move-down").click(function(e){e.preventDefault(),d(w(this),".column-selection",1)}),w(".row.dropdown-menu .move-up").click(function(e){e.preventDefault(),d(w(this),".row-selection",-1)}),w(".row.dropdown-menu .move-down").click(function(e){e.preventDefault(),d(w(this),".row-selection",1)}),w(".column.dropdown-menu .expand").click(function(e){e.preventDefault();var t=w(this),e=t.data("ref"),t=t.data("index");c(w(".column-selection").get(t),e+"L")}),w(".row.dropdown-menu .expand").click(function(e){e.preventDefault();var t=w(this),e=t.data("ref"),t=t.data("index");c(w(".row-selection").get(t),e+"L")}),w(".column.dropdown-menu .add-level").click(function(e){var t=w('<input type="text" name="column" class="column-selection form-control" readonly>');w("#pivot").append(t),t.val(w(this).data("ref")+"L"),w("#pivot").submit()}),w(".row.dropdown-menu .add-level").click(function(e){var t=w('<input type="text" name="row" class="row-selection form-control" readonly>');w("#pivot").append(t),t.val(w(this).data("ref")+"L"),w("#pivot").submit()}),w(".row.dropdown-menu .drill-up").click(function(e){e.preventDefault(),c(w(".row-selection").get(w(this).attr("data-ref")),w(this).attr("value-ref"))}),w(".row-target a").click(function(e){e.preventDefault(),c(w(".row-selection").get(w(this).closest(".row-target").attr("data-level")),w(this).attr("data-ref"))}),w(".column-target a").click(function(e){e.preventDefault(),c(w(".column-selection").get(w(this).closest(".column-target").attr("data-level")),w(this).attr("data-ref"))}),w(".reset-action").click(function(){w("#pivot input").remove(),w("#pivot").submit()}),w(".transpose-action").click(function(){w(".column-selection").attr("name","row"),w(".row-selection").attr("name","column"),w("#pivot").submit()}),w(".hide-empty-action").click(function(){var e=w("#pivot input[name=fo]");b.toggleField(e),w("#pivot").submit()}),w(".hide-zero-action").click(function(){var e=w("#pivot input[name=fz]");b.toggleField(e),w("#pivot").submit()}),w(".show-codes-action").click(function(){var e=w("#pivot input[name=sc]");b.toggleField(e),w("#pivot").submit()}),w("dl dd > span").click(function(){w(w(".filter-"+w(this).attr("data-ref")).get(w(this).attr("data-index"))).remove(),w("#pivot").submit()}).hover(function(){w(this).toggleClass("hover")});var u=w('<div class="dropdown">'),p=w('<button type="button" class="btn btn-secondary btn-sm drowdown-toggle" data-bs-toggle="dropdown"><span class="caret"></span></button>'),f=w('<ul class="dropdown-menu">'),m=w('<li><a role="menuitem" class="asc dropdown-item">'+b.messages["cube.dimension.sort.asc"]+"</a></li>"),v=w('<li><a role="menuitem" class="desc dropdown-item">'+b.messages["cube.dimension.sort.desc"]+"</a></li>"),g=w('<li><a role="menuitem" class="rowhide dropdown-item">'+b.messages["cube.dimension.hide"]+"</a></li>"),e=w('<li><a role="menuitem" class="info dropdown-item">'+b.messages["cube.dimension.info"]+"</a></li>");f.append(m).append(v).append(g).append(e),u.append(p).append(f),w(".row-target, .column-target").not(".accept-all").append(u).find(".asc,.desc").click(function(){var e=w("#pivot input[name=sort]"),t=w("#pivot input[name=mode]");b.toggleField(e),b.toggleField(t),t.val(w(this).attr("class")),0<w(this).closest(".row-target").length?e.val("r"+w(this).closest("th").attr("data-ref")):e.val("c"+w(this).closest("th").attr("data-ref")),w("#pivot").submit()});function h(e){e=window.open(e,"tikumetadata","scrollbars=1,menubar=0,resizable=1,status=0,location=0,width=650,height=450,screenX=250,screenY=350"),window.focus&&e.focus()}w("th .info").click(function(e){e.preventDefault();var t=w(this).closest(".row-target, .column-target").find("a").first().attr("data-ref"),e=t.lastIndexOf("-");h(window.location.protocol+"//"+window.location.host+b.url+t.substring(e+1))}),w("#measure-meta").click(function(e){e.preventDefault(),h(this.href)}),w("th .rowhide").click(function(){var e=w(this).closest(".row-target, .column-target"),t=e.attr("data-level"),o=e.find("a").first().attr("data-ref"),n=0,a=0,i=0,i=e.is(".row-target")?(n=b.rows[t].dimension,a=b.rows[t].nodes,w(".row-selection").get(t)):(n=b.columns[t].dimension,a=b.columns[t].nodes,w(".column-selection").get(t));a.splice(a.indexOf(o.substring(o.indexOf(b.separator)+1)),1),c(i,n+b.separator+a.join(b.subsetSeparator)+b.subsetSeparator)}),document.cookie.match(/cube_info/)||(w(".quick-info").removeClass("d-none"),w("#close-quick-info").click(function(){var e=new Date,t=e.getTime()+864e9;e.setTime(t),document.cookie="cube_info=shown;expires="+e.toGMTString()+"; path=/",w(".quick-info").removeClass("show")}))})}(window.jQuery,window.thl);